---
title: "Data visualization with R: reporting with Quarto"
subtitle: "Master in Data science for Management <br> AY 2025/2026"
author: "Andrea Cappozzo"
institute: "Faculty of Economics"
embed-resources: true
editor: visual
execute:
  echo: true
  warning: true
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: load-packages
#| include: false

library(tidyverse)
library(palmerpenguins)
```

## Meet Quarto

Quarto is an **open-source scientific and technical publishing system** that allows users to create dynamic documents, presentations, blogs, and websites using plain text files (.qmd). It supports multiple programming languages (like *R, Python, and Julia*) and integrates with Markdown to generate high-quality, reproducible reports in various formats, including HTML, PDF, and Word. To learn more about Quarto, see <https://quarto.org>. Disclaimer: the following section is an adaptation of the [Tutorial: Hello, Quarto](https://quarto.org/docs/get-started/hello/rstudio.html) that can be found in the Quarto website.

## An end-to-end example: meet the penguins!

The `penguins` data from the [palmerpenguins](https://allisonhorst.github.io/palmerpenguins "palmerpenguins R package") package contains size measurements for `{r} nrow(penguins)` penguins from three species observed on three islands in the Palmer Archipelago, Antarctica.

![](figures/lter_penguins.png)

The plot below shows the relationship between flipper and bill lengths of these penguins.

```{r}
#| label: plot-penguins
#| warning: false
#| echo: true

ggplot(penguins, aes(x = flipper_length_mm, y = bill_length_mm)) +
  geom_point(aes(color = species, shape = species)) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(
    title = "Flipper and bill length",
    subtitle = "Dimensions for penguins at Palmer Station LTER",
    x = "Flipper length (mm)",
    y = "Bill length (mm)",
    color = "Penguin species",
    shape = "Penguin species"
  ) +
  theme_minimal()
```

First off, let us report some summary statistics of the dataset at hand

```{r}
skimr::skim_without_charts(penguins)
```

Given that we are in the process of becoming data scientists, we will

1.  build a simple linear regression model to regress *Bill length* as a function of *Flipper length*
2.  compute coefficients and display the results
3.  report everything in a self-contained format (including code, tables etc) using Quarto!

In details, we are interested in estimating the coefficients $\alpha$ and $\beta_{1}$ of the following statistical model:

$$
\operatorname{bill\_length\_mm} = \alpha + \beta_{1}(\operatorname{flipper\_length\_mm}) + \epsilon
$$

All the details of the statistical procedure will be thoroughly explained in the Statistical Learning module, where you will explore the general formulation:

$$
y=\alpha + \beta_1 x + \epsilon
$$

in which $y$ is called the response variable and $x$ the independent variable. For now, the key point to understand is that we aim to examine how the response variable, $\operatorname{bill\_length\_mm}$, relates to the independent variable, $\operatorname{flipper\_length\_mm}$.

In R, this can be accomplished with the following line of code:

```{r}
fit_lm <- lm(bill_length_mm ~ flipper_length_mm, data = penguins)
```

The `fit_lm` object is a list with class `r class(fit_lm)` that stands for linear model. While again all the details regarding this type of model will become clear soon enough, we can exploit the Quarto capabilities to report results from the `fit_lm` object. Specifically, we can report a table summarizing the model coefficients using the `kable` function, that allows for creating tables in LaTeX, HTML and more.

```{r}
library(broom)
library(knitr)
tab_coef <- tidy(fit_lm)
tab_coef

tab_coef$p.value <- formatC(tab_coef$p.value, format = "e", digits = 2)

kable(tab_coef, digits = 3)
```

Look at the difference of having or not used `kable` in the previous call. In a report, generally we tend to include the least amount of code as possible: for example if we only want to report the table wihout include the code used to generate it we can specify the `echo: false` argument to the code chunk, resulting in @tbl-coef:

```{r}
#| echo: false
#| label: tbl-coef
#| tbl-cap: "My first Quarto table reporting the coefficients of my first linear model"

kable(tab_coef, digits = 3)
```

Notice that I have also added a caption and created a label that I can cite throughout my report. The same can be done for both Figures included in the manuscript as external files, as @fig-penguin, or plots produced by R code, like @fig-penguins_fit.

![A penguin](figures/penguin.jpeg){#fig-penguin}

Lastly, I report in @eq-fitted_lm the resulting estimated model:

$$
\operatorname{bill\_length\_mm} = \hat{\alpha} + \hat{\beta}_{1}(\operatorname{flipper\_length\_mm})
$$ {#eq-fitted_lm}

where $\hat{\alpha}=$`r round(coef(fit_lm)[1],3)` and $\hat{\beta}_{1}=$ `r round(coef(fit_lm)[2],3)`

```{r}
#| label: fig-penguins_fit
#| warning: false
#| echo: false
#| fig-cap: "My first Quarto figure reporting the fitted line of my first linear model"

ggplot(penguins, aes(x = flipper_length_mm, y = bill_length_mm)) +
  geom_point(aes(color = species, shape = species)) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(
    title = "Flipper and bill length",
    subtitle = "Dimensions for penguins at Palmer Station LTER",
    x = "Flipper length (mm)",
    y = "Bill length (mm)",
    color = "Penguin species",
    shape = "Penguin species"
  ) +
  geom_abline(
    slope = fit_lm$coefficients[2],
    intercept = fit_lm$coefficients[1],
    linewidth = 2,
    col = "darkblue"
  ) +
  theme_minimal()
```

## Conclusion

By default, this document is rendered as an HTML file, but Quarto can generate many other formats as well (check out all the available options [here](https://quarto.org/docs/output-formats/all-formats.html)). You can set the default format in the YAML metadata, or generate multiple formats from the same .qmd file by specifying them in the terminal, for example:

```{bash}
#| eval: false
quarto render 03-RDATAVIZ_26_quarto.qmd --to pdf,html
```

The course was designed to teach you state-of-the-art tools for constructing data storytelling using `R`. We covered `dplyr` for data manipulation, `ggplot2` for data visualization, and Quarto as a technical publishing system. Bear in mind, however, that Data Science is an ever-evolving discipline, and it’s more important than ever to stay updated on active developments. Specifically, the emerging role of AI is reshaping every phase we've covered — from data collection and cleaning to analysis, visualization, and communication — and now it's time for a hands-on session so you can experience these tools in practice!